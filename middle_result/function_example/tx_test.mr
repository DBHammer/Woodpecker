1,3:Connection conn1=get_conn[master]
2,3:Connection conn2=get_conn[master]
3,3:Statement stmt1=get_stat[conn1]
4,3:PStatement pstmt1=get_pstat[conn1;"update t1 set c2 = c2 - ? where c1 = ?";Decimal,int]
5,3:Statement stmt2=get_stat[conn2]
6,3:PStatement pstmt2=get_pstat[conn2;"update t1 set c2 = c2 - ? where c1 = ?";Decimal,int]
8,1:sql["drop table if exists t1";stmt1]
9,1:sql["create table t1 (c1 int primary key, c2 decimal(4,2), c3 varchar(100))";stmt1]
10,1:sleep[2;second]
11,1:sql["insert into t1 values (1, 10, 'aaaaa'), (2, 10, 'bbbbb'), (3, 10, 'ccccc')";stmt2]
12,1:tx[conn1;start]
13,1:psql[pstmt1;1.5,1]
14,1:tx[conn2;start]
15,3:ResultSet rs1=sql["select c2 from t1 where c1 = 1";stmt2]
16,1:psql[pstmt2;3.5,2]
17,3:ResultSet rs2=sql["select c2 from t1 where c1 = 2";stmt1]
18,1:tx[conn1;commit]
19,1:tx[conn2;rollback]
20,3:ResultSet rs3=sql["select c2 from t1 where c1 = 1";stmt2]
21,3:ResultSet rs4=sql["select c2 from t1 where c1 = 2";stmt2]
23,0:IdealResultSet<Decimal> irs0
24,0:IdealResultSet<Decimal> irs1
25,0:IdealResultSet<Decimal> irs2
26,0:IdealResultSet<Decimal> irs3
27,1:import_irs["tx_test"][irs0 0,irs1 1,irs2 2,irs3 3]
28,1:verify[rs1;==;irs0]
29,1:verify[rs2;==;irs1]
30,1:verify[rs3;==;irs2]
31,1:verify[rs4;==;irs3]
